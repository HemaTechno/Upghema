<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>صفحتي الشخصية</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #000;
            color: #ff0000;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .scripts-list {
            max-width: 800px;
            margin: 0 auto;
        }
        .script-item {
            background-color: #111;
            border: 2px solid #ff0000;
            border-radius: 10px;
            margin-bottom: 15px;
            padding: 15px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .script-item img {
            max-width: 120px;
            max-height: 80px;
            border-radius: 8px;
            object-fit: cover;
        }
        .script-info {
            flex-grow: 1;
            text-align: right;
        }
        .script-info h3 {
            margin: 0 0 10px;
            font-size: 20px;
        }
        .script-info p {
            margin: 5px 0;
        }
        .script-actions button {
            background-color: #ff0000;
            border: none;
            padding: 8px 12px;
            margin-left: 8px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .script-actions button:hover {
            background-color: #a71d2a;
        }
        .no-scripts {
            text-align: center;
            margin-top: 40px;
            font-size: 18px;
            color: #aaa;
        }
    </style>
</head>
<body>

<h1>صفحتي الشخصية</h1>

<div class="scripts-list" id="scriptsList">
    <!-- السكربتات ستعرض هنا -->
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-storage-compat.js"></script>

<script>
    // Firebase config هنا
    const firebaseConfig = {
        apiKey: "AIzaSyDoK427q44Fj87JhgZh2vKeUnACkjl8HDc",
        authDomain: "treng-c6027.firebaseapp.com",
        projectId: "treng-c6027",
        storageBucket: "treng-c6027.appspot.com",
        messagingSenderId: "305527546716",
        appId: "1:305527546716:web:fd072a58200f31bb42d799",
        measurementId: "G-3JFKFT2LT0"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // تحقق من تسجيل الدخول
    auth.onAuthStateChanged(user => {
        if (!user) {
            // لو مش مسجل دخول يرجع للصفحة login
            window.location.href = "login.html";
        } else {
            loadUserScripts(user.uid);
        }
    });

    // جلب وعرض السكربتات الخاصة بالمستخدم
    async function loadUserScripts(userId) {
        const scriptsList = document.getElementById("scriptsList");
        scriptsList.innerHTML = "جارٍ تحميل السكربتات...";

        try {
            const querySnapshot = await db.collection("scripts")
                .where("userId", "==", userId)
                .orderBy("addedDate", "desc")
                .get();

            if (querySnapshot.empty) {
                scriptsList.innerHTML = '<p class="no-scripts">لم تقم بإضافة أي سكربت بعد.</p>';
                return;
            }

            scriptsList.innerHTML = "";
            querySnapshot.forEach(doc => {
                const script = doc.data();
                const scriptId = doc.id;

                const scriptElement = document.createElement("div");
                scriptElement.className = "script-item";

                scriptElement.innerHTML = `
                    <img src="${script.imageUrl}" alt="صورة السكربت" />
                    <div class="script-info">
                        <h3>${script.title}</h3>
                        <p><strong>اسم اللعبة:</strong> ${script.mapName}</p>
                        <p><strong>الوصف:</strong> ${script.description}</p>
                        <p><strong>اسم السكربت:</strong> ${script.scriptName}</p>
                        <p><strong>مفتاح السكربت:</strong> ${script.scriptKey || 'لا يوجد'}</p>
                        <p><strong>تاريخ الإضافة:</strong> ${script.addedDate}</p>
                    </div>
                    <div class="script-actions">
                        <button onclick="editScript('${scriptId}')">تعديل</button>
                        <button onclick="deleteScript('${scriptId}')">حذف</button>
                    </div>
                `;

                scriptsList.appendChild(scriptElement);
            });
        } catch (error) {
            console.error("خطأ في جلب السكربتات:", error);
            scriptsList.innerHTML = '<p class="no-scripts">حدث خطأ أثناء تحميل السكربتات.</p>';
        }
    }

    // حذف سكربت
    async function deleteScript(scriptId) {
        if (!confirm("هل أنت متأكد من حذف هذا السكربت؟")) return;

        try {
            await db.collection("scripts").doc(scriptId).delete();
            alert("تم حذف السكربت بنجاح.");
            // إعادة تحميل السكربتات بعد الحذف
            const user = auth.currentUser;
            if (user) loadUserScripts(user.uid);
        } catch (error) {
            console.error("خطأ في حذف السكربت:", error);
            alert("حدث خطأ أثناء حذف السكربت.");
        }
    }

    // تعديل السكربت (سنجعلها بسيطة: إعادة التوجيه إلى صفحة التعديل مع ID السكربت)
    function editScript(scriptId) {
        window.location.href = `edit-script.html?id=${scriptId}`;
    }
</script>

</body>
</html>
